{% extends "base.html" %} {% block content %}

{% for post in posts %}
<div class="well post">
    <div class="media row">
        <a class="pull-left col-md-2" href="#">
            <img class="media-object img-rounded" src="{% url 'musicsharing.views.get_profile_picture' post.user.profile.all.0.id %}">
        </a>
        <div class="col-md-10">
            <h4 class="media-heading"><a href="{% url 'musicsharing.views.profile' post.user.username %}">{{post.user.username}}</a><a href="#" data-toggle="modal" data-target="#myModal" class="comment-btn"><input type="hidden" value="{{ post.id }}"></input><span class="glyphicon glyphicon-comment pull-right" aria-hidden="true"></span></a></h4>
            <p class="blog-post-meta"><span>{{ post.date | date:"Y-m-d H:i:s"}}</span></p>
            <p>{{post.content}}</p>
            <div class="post-song">
                <div class="row">
                    <img class="img-square pull-left" src="{% url 'musicsharing.views.get_picture' post.music.name %}" alt="...">
                    <p class="post-song-title">{{post.music.name}}</p>
                    <!-- <form method="post" >
                        <button type="submit" class="btn btn-success addtosong pull-right">+ Add to Songs</button>
                        {% csrf_token %}
                    </form> -->
                    <p class="post-song-content">
                            {{post.music.artist}} / {{post.music.album}}
                    </p>
                </div>
            </div>

            <div class="comments" id="comment-list-{{ post.id }}">
                {% for comment in comments %}
                {% if comment.post.id == post.id %}
                <div class="row pull-left">
                    <div class="col-md-1">
                        <img class="img-rounded" src="{% url 'musicsharing.views.get_profile_picture' comment.user.profile.all.0.id %}" alt="...">
                    </div>
                    <div class="col-md-11">
                        <div class="post-comments">
                            <p class="blog-post-meta">{{ comment.date | date:"Y-m-d H:i:s"}} &nbsp;<a href="{% url 'musicsharing.views.profile' comment.user.username %}">{{comment.user.username}}</a> says : </p>
                            <p class="comment-content">
                                {{comment.content}}
                            </p>
                        </div>
                        <div style="clear:both"></div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
                <div style="clear:both"></div>
            </div>
        </div>
    </div>
</div>
{% endfor %}

    <div class="modal fade comment-modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Comment</h4>
                </div>
                <div class="modal-body" id="myModal-body">
                    <form method="post" action="{% url 'musicsharing.views.comment' %}" id="comment-form-141">
                        <textarea class="form-control" cols="40" id="id_comment_content" maxlength="160" name="content" rows="3"></textarea>
                        {% csrf_token %}
                        <input type="hidden" name="post_id" id="comment-modal-id" value="3"></input>
                        <input type="hidden" name="user_name" id="comment-modal-id" value="{{ user.username }}"></input>
                        <input type="hidden" name="profile_id" value="{{ user.profile.all.0.id }}"></input>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="submit" form="comment-form-141" class="btn btn-primary">Submit Comment</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block js %}
{% load staticfiles %}
<script src="{% static "js/comment.js" %}"></script>
{% endblock %}